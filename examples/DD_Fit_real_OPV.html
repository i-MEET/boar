<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BOAR with SIMsalabim Organic Photovoltaic (OPV) example &mdash; boar 1.0.10 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=61a4c737" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css?v=f4aeca0c" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css?v=2082cf3c" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/rtd_sphinx_search.min.css" />
      <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=377e76b0"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../_static/copybutton.js?v=f281be69"></script>
        <script src="../_static/js/rtd_search_config.js"></script>
        <script src="../_static/js/rtd_sphinx_search.min.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="BOAR for TAS fitting" href="TAS_fit_BT_model_fake.html" />
    <link rel="prev" title="BOAR with SIMsalabim" href="DD_Fit_fake_OPV.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            boar
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting started:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html#additional-necessary-installs-for-the-agents">Additional necessary installs for the agents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html#disclaimer">Disclaimer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html">Scientific publications based on the BOAR project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../change_log.html">Change Log</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Model fitting examples:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="DD_Fit_fake_OPV.html">BOAR with SIMsalabim</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">BOAR with SIMsalabim Organic Photovoltaic (OPV) example</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Import-Experimental-Data">Import Experimental Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Fit-non-ideal-diode-model">Fit non-ideal diode model</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Multi-Objective-Optimization">Multi-Objective Optimization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Define-the-fitting-parameters">Define the fitting parameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Start-the-optimization">Start the optimization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="TAS_fit_BT_model_fake.html">BOAR for TAS fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="MO_TrPL_TrMC.html">Multi-Objective Fitting of TrPL and TrMC Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gallery_fitting.html">Notebooks gallery</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Optimization and DoE examples:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="BOAR_Exp.html">Design of Experiments to optimize perovskite solar cells efficiency</a></li>
<li class="toctree-l1"><a class="reference internal" href="BOAR_Exp_MO.html">Multi-objective optimization for perovskite material composition</a></li>
<li class="toctree-l1"><a class="reference internal" href="TM_AVT_Jsc_MO_custom_func.html">Custom evaluate function for Multi-Objective Optimization - Transfer Matrix example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gallery_Opti_DoE.html">Notebooks gallery</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">BOAR API:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">boar</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">boar</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">BOAR with SIMsalabim Organic Photovoltaic (OPV) example</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/i-MEET/boar/blob/main/docs/source/examples/DD_Fit_real_OPV.ipynb" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="BOAR-with-SIMsalabim-Organic-Photovoltaic-(OPV)-example">
<h1>BOAR with SIMsalabim Organic Photovoltaic (OPV) example<a class="headerlink" href="#BOAR-with-SIMsalabim-Organic-Photovoltaic-(OPV)-example" title="Link to this heading"></a></h1>
<p>Version 1.0.0 (c) Vincent M. Le Corre, Larry Lueer, i-MEET 2021-2023</p>
<div class="line-block">
<div class="line">This notebook is made to use BOAR in combination with drift-diffusion modeling to fit of ‘fake’ JV curves.</div>
<div class="line">To perform the drift-diffusion simulation in the background we use the open-source program <a class="reference external" href="https://github.com/kostergroup/SIMsalabim">SIMsalabim</a>, for more information about SIMsalabim please check the <a class="reference external" href="https://github.com/kostergroup/SIMsalabim">GitHub repository</a></div>
<div class="line">Make sure you have SIMsalabim installed before running this Notebook.</div>
</div>
<div class="line-block">
<div class="line">Here we are fitting an typical OPV cell with the following structure:</div>
<div class="line">ITO|ZnO|PM6-L8BO-PCBM|MoOx|Ag</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Activate matplotlib widgets</span>
<span class="c1"># %matplotlib inline</span>
<span class="c1"># comment the next line if you are on the jupyterhub server</span>
<span class="c1"># %matplotlib widget</span>
<span class="c1"># %matplotlib notebook</span>

<span class="c1"># Import libraries</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span><span class="nn">os</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">minmax_scale</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span> <span class="c1"># comment this out to see warnings</span>

<span class="c1"># Import boar package</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;../&#39;</span><span class="p">))</span> <span class="c1"># add directory containing boar package to path</span>
<span class="kn">from</span> <span class="nn">boar</span> <span class="kn">import</span> <span class="o">*</span>
<br/></pre></div>
</div>
</div>
<section id="Import-Experimental-Data">
<h2>Import Experimental Data<a class="headerlink" href="#Import-Experimental-Data" title="Link to this heading"></a></h2>
<div class="line-block">
<div class="line">In this section you need to write a function that imports the experimental data. The function should return two array X and y. X is a 2D array with the experimental data. Each row of X is a data point. y is a 1D array with the experimental results. Each row of y is a result vector for the corresponding data point in X.</div>
<div class="line">For example, if you are trying to fit light-intensity dependent JV curves, then X is a 2D array (or list) with in the first column the applied voltage (‘Vext’) and in the second column the light intensity (‘Gfrac’) and y is a 1D array (or list) with the JV curves. If you have several light intensities, just append the data to X and y.</div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>      <span class="n">Vext</span>   <span class="n">Gfrac</span>             <span class="n">Jext</span>
     <span class="n">_</span>            <span class="n">_</span>          <span class="n">_</span>        <span class="n">_</span>
<span class="n">X</span> <span class="o">=</span> <span class="o">|</span>  <span class="mi">0</span>   <span class="o">|</span>   <span class="mi">0</span>   <span class="o">|</span>   <span class="n">y</span> <span class="o">=</span>  <span class="o">|</span>  <span class="n">J</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>  <span class="o">|</span>
    <span class="o">|</span> <span class="mf">0.1</span>  <span class="o">|</span>   <span class="mi">0</span>   <span class="o">|</span>        <span class="o">|</span> <span class="n">J</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">|</span>
    <span class="o">|</span>  <span class="o">.</span>   <span class="o">|</span>   <span class="o">.</span>   <span class="o">|</span>        <span class="o">|</span>   <span class="o">.</span>      <span class="o">|</span>
    <span class="o">|</span>  <span class="o">.</span>   <span class="o">|</span>   <span class="o">.</span>   <span class="o">|</span>        <span class="o">|</span>   <span class="o">.</span>      <span class="o">|</span>
    <span class="o">|</span>  <span class="o">.</span>   <span class="o">|</span>   <span class="o">.</span>   <span class="o">|</span>        <span class="o">|</span>   <span class="o">.</span>      <span class="o">|</span>
    <span class="o">|</span>  <span class="o">.</span>   <span class="o">|</span>   <span class="o">.</span>   <span class="o">|</span>        <span class="o">|</span>   <span class="o">.</span>      <span class="o">|</span>
    <span class="o">|</span>  <span class="mi">1</span>   <span class="o">|</span>   <span class="mi">0</span>   <span class="o">|</span>        <span class="o">|</span> <span class="n">J</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>   <span class="o">|</span>
    <span class="o">|</span>  <span class="mi">0</span>   <span class="o">|</span>   <span class="mi">1</span>   <span class="o">|</span>        <span class="o">|</span> <span class="n">J</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>   <span class="o">|</span>
    <span class="o">|</span> <span class="mf">0.1</span>  <span class="o">|</span>   <span class="mi">1</span>   <span class="o">|</span>        <span class="o">|</span> <span class="n">J</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">|</span>
    <span class="o">|</span>  <span class="o">.</span>   <span class="o">|</span>   <span class="o">.</span>   <span class="o">|</span>        <span class="o">|</span>   <span class="o">.</span>      <span class="o">|</span>
    <span class="o">|</span>  <span class="o">.</span>   <span class="o">|</span>   <span class="o">.</span>   <span class="o">|</span>        <span class="o">|</span>   <span class="o">.</span>      <span class="o">|</span>
    <span class="o">|</span>  <span class="o">.</span>   <span class="o">|</span>   <span class="o">.</span>   <span class="o">|</span>        <span class="o">|</span>   <span class="o">.</span>      <span class="o">|</span>
    <span class="o">|</span><span class="n">_</span> <span class="mi">1</span>   <span class="o">|</span>   <span class="mi">1</span>  <span class="n">_</span><span class="o">|</span>        <span class="o">|</span><span class="n">_</span> <span class="n">J</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="n">_</span><span class="o">|</span>
</pre></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the path to the data and to the SIMsalabim directory</span>
<span class="n">curr_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="n">parent_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">curr_dir</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">))</span> <span class="c1"># path to the parent directory</span>
<span class="n">path2simu</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parent_dir</span><span class="p">,</span> <span class="s1">&#39;SIMsalabim&#39;</span><span class="p">,</span><span class="s1">&#39;SimSS&#39;</span><span class="p">)</span> <span class="c1"># path to the SIMsalabim directory</span>
<span class="c1"># Directory where the results are stored</span>
<span class="n">res_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">curr_dir</span><span class="p">,</span><span class="s1">&#39;temp&#39;</span><span class="p">)</span> <span class="c1"># absolute path to the results directory (note that this will be delete in the last cell of this notebook)</span>
<span class="n">dev_par_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parent_dir</span><span class="p">,</span><span class="s1">&#39;Example_Data&#39;</span><span class="p">,</span><span class="s1">&#39;Chao&#39;</span><span class="p">,</span><span class="s1">&#39;device_parameters_chao.txt&#39;</span><span class="p">)</span> <span class="c1"># absolute path to the device parameter file</span>
<span class="n">path2JV</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parent_dir</span><span class="p">,</span><span class="s1">&#39;Example_Data&#39;</span><span class="p">,</span><span class="s1">&#39;Chao&#39;</span><span class="p">)</span> <span class="c1"># absolute path to the JV file</span>

<span class="c1"># Define the fixed parameters and the light intensities</span>
<span class="n">X_dimensions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Vext&#39;</span><span class="p">,</span><span class="s1">&#39;Gfrac&#39;</span><span class="p">]</span>
<span class="n">suns</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example function to import JV data</span>
<span class="k">def</span> <span class="nf">get_JV_exp</span><span class="p">(</span><span class="n">suns</span><span class="p">,</span><span class="n">path2JV</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">Vlim</span><span class="o">=</span><span class="p">[],</span><span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Example function to import JV data from csv files</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    suns : list of floats</span>
<span class="sd">        List of light intensities</span>
<span class="sd">    path2JV : str, optional</span>
<span class="sd">        Path to the JV data, by default &#39;&#39;</span>
<span class="sd">    Vlim : list, optional</span>
<span class="sd">        Voltage limits, by default []</span>
<span class="sd">    plot : bool, optional</span>
<span class="sd">        Plot the JV curves, by default True</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Xs : list of lists</span>
<span class="sd">        List of lists of the voltage and light intensity</span>
<span class="sd">    ys : list of floats</span>
<span class="sd">        List of the current densities</span>
<span class="sd">    weights_ : list of floats</span>
<span class="sd">        List of the weights</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Xs</span><span class="p">,</span><span class="n">ys</span> <span class="o">=</span> <span class="p">[],[]</span>
    <span class="n">weights_</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">markers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="s1">&#39;^&#39;</span><span class="p">,</span><span class="s1">&#39;v&#39;</span><span class="p">]</span>
    <span class="c1"># markers = [None,None,None,None]</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;-&quot;</span><span class="p">,</span><span class="s2">&quot;--&quot;</span><span class="p">,</span><span class="s2">&quot;-.&quot;</span><span class="p">,</span><span class="s2">&quot;:&quot;</span><span class="p">]</span>

    <span class="n">JvExp_filename</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">suns</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="s1">&#39;dark&#39;</span><span class="p">:</span>
            <span class="n">JvExp_filename</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path2JV</span><span class="p">,</span><span class="s1">&#39;1#-pin5_O-ZnO-PM6-L8BO-C70_dark-fresh.csv&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">JvExp_filename</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path2JV</span><span class="p">,</span><span class="s1">&#39;1#-pin5_O-ZnO-PM6-L8BO-C70_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; sun-fresh.csv&#39;</span><span class="p">))</span>



    <span class="n">Gfracs</span> <span class="o">=</span> <span class="n">suns</span>

    <span class="n">err</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">J</span><span class="p">,</span><span class="n">Gfrac</span> <span class="o">=</span> <span class="p">[],[],[],[]</span>
    <span class="n">X</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="p">[],[]</span>

    <span class="n">weights</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">G</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">JvExp_filename</span><span class="p">,</span><span class="n">Gfracs</span><span class="p">):</span>
        <span class="n">power</span><span class="p">,</span><span class="n">Vs</span> <span class="o">=</span> <span class="p">[],[]</span>
        <span class="n">data2fit</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;V&#39;</span><span class="p">,</span><span class="s1">&#39;J&#39;</span><span class="p">],</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="c1"># data2fit.dropna(how=&quot;all&quot;, inplace=True) # drop the empty line at file-end</span>
        <span class="k">if</span> <span class="n">Vlim</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">Vmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">data2fit</span><span class="p">[</span><span class="s1">&#39;V&#39;</span><span class="p">])</span>
            <span class="n">Vmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">data2fit</span><span class="p">[</span><span class="s1">&#39;V&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Vmin</span> <span class="o">=</span> <span class="n">Vlim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">Vmax</span> <span class="o">=</span> <span class="n">Vlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data2fit</span><span class="p">[</span><span class="s1">&#39;V&#39;</span><span class="p">],</span><span class="n">data2fit</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Gfrac = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">G</span><span class="p">),</span><span class="n">marker</span><span class="o">=</span><span class="n">markers</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;C&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">),</span><span class="n">linestyle</span><span class="o">=</span><span class="n">lines</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">240</span><span class="p">,</span><span class="mi">10</span><span class="p">])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;V [V]&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Current density [A/m$^2$]&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data2fit</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;V&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">Vmin</span> <span class="ow">and</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;V&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">Vmax</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">G</span><span class="o">==</span><span class="s1">&#39;dark&#39;</span><span class="p">:</span>
                    <span class="n">G</span><span class="o">=</span><span class="mi">0</span>
                <span class="n">Vs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;V&#39;</span><span class="p">])</span>
                <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;V&#39;</span><span class="p">],</span><span class="n">G</span><span class="p">])</span>
                <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">G</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">power</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">power</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;V&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">])</span>

        <span class="n">V</span><span class="o">=</span><span class="n">data2fit</span><span class="p">[</span><span class="s1">&#39;V&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">G</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">power</span> <span class="o">=</span> <span class="n">minmax_scale</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">power</span><span class="p">),</span> <span class="n">feature_range</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">power</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">power</span><span class="p">))</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">power</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Vs</span><span class="p">,</span><span class="n">power</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Gfrac = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">G</span><span class="p">),</span><span class="n">marker</span><span class="o">=</span><span class="n">markers</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;C&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">),</span><span class="n">linestyle</span><span class="o">=</span><span class="n">lines</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;V [V]&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Weight&#39;</span><span class="p">)</span>


        <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">weights</span>

<span class="n">Xs</span><span class="p">,</span><span class="n">ys</span><span class="p">,</span><span class="n">weights_</span> <span class="o">=</span> <span class="n">get_JV_exp</span><span class="p">(</span><span class="n">suns</span><span class="p">,</span><span class="n">Vlim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">path2JV</span><span class="o">=</span><span class="n">path2JV</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_DD_Fit_real_OPV_5_0.png" src="../_images/examples_DD_Fit_real_OPV_5_0.png" />
</div>
</div>
</section>
<section id="Fit-non-ideal-diode-model">
<h2>Fit non-ideal diode model<a class="headerlink" href="#Fit-non-ideal-diode-model" title="Link to this heading"></a></h2>
<p>In this section you need to write a function that fits the non-ideal diode model to dark-JV curves. We do this to get the series resistance (‘Rseries’) and shunt resistance (‘Rshunt’) from the dark-JV curves to avoid fitting them in the multi-objective optimization.</p>
<p>Note: Running this cell is not necessary, run it only if you want to see the results.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import  and fit diode equation to dark JV data</span>
<span class="n">fit_dark</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">if</span> <span class="n">fit_dark</span><span class="p">:</span>

    <span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">weights</span> <span class="o">=</span> <span class="n">get_JV_exp</span><span class="p">([</span><span class="s1">&#39;dark&#39;</span><span class="p">],</span><span class="n">Vlim</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span><span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">path2JV</span><span class="o">=</span><span class="n">path2JV</span><span class="p">)</span> <span class="c1"># import dark JV data</span>
    <span class="n">pins</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;1#-pin5_O-ZnO-PM6-L8BO-C70&#39;</span><span class="p">]</span>
    <span class="n">markers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="s1">&#39;^&#39;</span><span class="p">,</span><span class="s1">&#39;v&#39;</span><span class="p">]</span>
    <span class="n">Rs</span><span class="p">,</span> <span class="n">Rsh</span><span class="p">,</span> <span class="n">J0</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">errRs</span><span class="p">,</span> <span class="n">errRsh</span><span class="p">,</span> <span class="n">errJ0</span><span class="p">,</span> <span class="n">errn</span> <span class="o">=</span> <span class="p">[],[],[],[],[],[],[],[]</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">dio</span> <span class="o">=</span> <span class="n">Non_Ideal_Diode_agent</span><span class="p">()</span>

    <span class="n">V</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">J</span> <span class="o">=</span> <span class="n">y</span>
    <span class="c1"># Fit the non ideal diode equation</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">dio</span><span class="o">.</span><span class="n">FitNonIdealDiode</span><span class="p">(</span><span class="n">V</span><span class="p">,</span><span class="n">J</span><span class="p">,</span><span class="n">T</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span><span class="n">JV_type</span><span class="o">=</span><span class="s1">&#39;dark&#39;</span><span class="p">,</span><span class="n">take_log</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">([</span><span class="mf">1e-20</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">1e-8</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">],</span> <span class="p">[</span><span class="mf">1e-3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">1e2</span><span class="p">,</span> <span class="mf">1e8</span><span class="p">]),</span><span class="n">p_start</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;J0&#39;</span><span class="p">:</span><span class="mf">1e-6</span><span class="p">})</span>
    <span class="n">Rs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;Rs&#39;</span><span class="p">])</span>
    <span class="n">Rsh</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;Rsh&#39;</span><span class="p">])</span>
    <span class="n">J0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;J0&#39;</span><span class="p">])</span>
    <span class="n">n</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">])</span>
    <span class="n">errRs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;Rs_err&#39;</span><span class="p">])</span>
    <span class="n">errRsh</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;Rsh_err&#39;</span><span class="p">])</span>
    <span class="n">errJ0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;J0_err&#39;</span><span class="p">])</span>
    <span class="n">errn</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;n_err&#39;</span><span class="p">])</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">V</span><span class="p">,</span><span class="nb">abs</span><span class="p">(</span><span class="n">J</span><span class="p">),</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;C&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">V</span><span class="p">,</span><span class="nb">abs</span><span class="p">(</span><span class="n">dio</span><span class="o">.</span><span class="n">NonIdealDiode_dark</span><span class="p">(</span><span class="n">V</span><span class="p">,</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;J0&#39;</span><span class="p">],</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">],</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;Rs&#39;</span><span class="p">],</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;Rsh&#39;</span><span class="p">])),</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;C&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
    <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Voltage [V]&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Current [A/m$^2$]&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">1e-4</span><span class="p">,</span><span class="mf">1e5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">pins</span><span class="p">,</span> <span class="n">Rs</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">errRs</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;b.&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">pins</span><span class="p">,</span> <span class="n">Rs</span><span class="p">,</span> <span class="s1">&#39;b.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Rs&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Pins&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;R$_s$ [$\Omega$ m$^2$]&#39;</span><span class="p">)</span>

    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">pins</span><span class="p">,</span> <span class="n">Rsh</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">errRsh</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;b.&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">pins</span><span class="p">,</span> <span class="n">Rsh</span><span class="p">,</span> <span class="s1">&#39;b.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Rsh&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Pins&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;R$_</span><span class="si">{sh}</span><span class="s1">$ [$\Omega$ m$^2$]&#39;</span><span class="p">)</span>

    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">pins</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">errn</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;b.&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pins</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="s1">&#39;b.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;n&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Pins&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Ideality factor&#39;</span><span class="p">)</span>

    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">pins</span><span class="p">,</span> <span class="n">J0</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">errJ0</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;b.&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">pins</span><span class="p">,</span> <span class="n">J0</span><span class="p">,</span> <span class="s1">&#39;b.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;J0&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Pins&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;J$_0$ [A m$^{-2}$]&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_DD_Fit_real_OPV_7_0.png" src="../_images/examples_DD_Fit_real_OPV_7_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_DD_Fit_real_OPV_7_1.png" src="../_images/examples_DD_Fit_real_OPV_7_1.png" />
</div>
</div>
</section>
<section id="Multi-Objective-Optimization">
<h2>Multi-Objective Optimization<a class="headerlink" href="#Multi-Objective-Optimization" title="Link to this heading"></a></h2>
<p>Below we will perform the Bayesian optimization to fit the experimental data.</p>
<section id="Define-the-fitting-parameters">
<h3>Define the fitting parameters<a class="headerlink" href="#Define-the-fitting-parameters" title="Link to this heading"></a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># define Fitparameters</span>
<span class="n">Start_values</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;kdirect&#39;</span><span class="p">:</span><span class="mf">5e-18</span><span class="p">,</span><span class="s1">&#39;mun_0&#39;</span><span class="p">:</span><span class="mf">2e-8</span><span class="p">,</span><span class="s1">&#39;mup_0&#39;</span><span class="p">:</span><span class="mf">8e-8</span><span class="p">,</span><span class="s1">&#39;Nc&#39;</span><span class="p">:</span><span class="mf">5e26</span><span class="p">,</span><span class="s1">&#39;Gehp&#39;</span><span class="p">:</span><span class="mf">1.28e28</span><span class="p">,</span><span class="s1">&#39;Bulk_tr&#39;</span><span class="p">:</span><span class="mf">1e20</span><span class="p">,</span><span class="s1">&#39;Gehp&#39;</span><span class="p">:</span><span class="mf">1.28e28</span><span class="p">}</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">Bulk_tr</span> <span class="o">=</span> <span class="n">Fitparam</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Bulk_tr&#39;</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="n">Start_values</span><span class="p">[</span><span class="s1">&#39;Bulk_tr&#39;</span><span class="p">]</span> <span class="p">,</span> <span class="n">relRange</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">lims</span><span class="o">=</span><span class="p">[</span><span class="mf">1e17</span><span class="p">,</span><span class="mf">5e22</span><span class="p">],</span><span class="n">range_type</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span><span class="n">optim_type</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span><span class="n">lim_type</span><span class="o">=</span><span class="s1">&#39;absolute&#39;</span><span class="p">,</span><span class="n">display_name</span><span class="o">=</span><span class="s1">&#39;N$_</span><span class="si">{Tr}</span><span class="s1">$&#39;</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="s1">&#39;m$^{-3}$&#39;</span><span class="p">)</span>
<span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Bulk_tr</span><span class="p">)</span>

<span class="n">kdirect</span> <span class="o">=</span> <span class="n">Fitparam</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;kdirect&#39;</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="n">Start_values</span><span class="p">[</span><span class="s1">&#39;kdirect&#39;</span><span class="p">]</span> <span class="p">,</span> <span class="n">relRange</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">lims</span><span class="o">=</span><span class="p">[</span><span class="mf">1e-19</span><span class="p">,</span><span class="mf">1e-15</span><span class="p">],</span><span class="n">range_type</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span><span class="n">optim_type</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span><span class="n">lim_type</span><span class="o">=</span><span class="s1">&#39;absolute&#39;</span><span class="p">,</span><span class="n">display_name</span><span class="o">=</span><span class="s1">&#39;k$_</span><span class="si">{2}</span><span class="s1">$&#39;</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="s1">&#39;m$^</span><span class="si">{3}</span><span class="s1">$ s$^{-1}$&#39;</span><span class="p">)</span>
<span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kdirect</span><span class="p">)</span>

<span class="n">mun_0</span> <span class="o">=</span> <span class="n">Fitparam</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;mun_0&#39;</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="n">Start_values</span><span class="p">[</span><span class="s1">&#39;mun_0&#39;</span><span class="p">]</span> <span class="p">,</span> <span class="n">relRange</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">lims</span><span class="o">=</span><span class="p">[</span><span class="mf">1e-8</span><span class="p">,</span><span class="mf">1e-6</span><span class="p">],</span><span class="n">range_type</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span><span class="n">optim_type</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span><span class="n">lim_type</span><span class="o">=</span><span class="s1">&#39;absolute&#39;</span><span class="p">,</span><span class="n">display_name</span><span class="o">=</span><span class="s1">&#39;$\mu_n$&#39;</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="s1">&#39;m$^</span><span class="si">{2}</span><span class="s1">$ V$^{-1}$ s$^{-1}$&#39;</span><span class="p">)</span>
<span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mun_0</span><span class="p">)</span>

<span class="n">mup_0</span> <span class="o">=</span> <span class="n">Fitparam</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;mup_0&#39;</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="n">Start_values</span><span class="p">[</span><span class="s1">&#39;mup_0&#39;</span><span class="p">]</span> <span class="p">,</span> <span class="n">relRange</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">lims</span><span class="o">=</span><span class="p">[</span><span class="mf">1e-8</span><span class="p">,</span><span class="mf">1e-6</span><span class="p">],</span><span class="n">range_type</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span><span class="n">optim_type</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span><span class="n">lim_type</span><span class="o">=</span><span class="s1">&#39;absolute&#39;</span><span class="p">,</span><span class="n">display_name</span><span class="o">=</span><span class="s1">&#39;$\mu_p$&#39;</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="s1">&#39;m$^</span><span class="si">{2}</span><span class="s1">$ V$^{-1}$ s$^{-1}$&#39;</span><span class="p">)</span>
<span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mup_0</span><span class="p">)</span>

<span class="c1"># If you want to also fit the series and shunt resistance, uncomment the following lines</span>
<span class="c1"># Rseries = Fitparam(name = &#39;Rseries&#39;, val = 1e-4, relRange = 1, lims=[1e-5,1e-1],range_type=&#39;log&#39;,optim_type=&#39;log&#39;,lim_type=&#39;absolute&#39;,display_name=&#39;R$_{s}$&#39;,unit=&#39;$\Omega$ m$^2$)</span>
<span class="c1"># params.append(Rseries)</span>

<span class="c1"># Rshunt = Fitparam(name = &#39;Rshunt&#39;, val = 3e2 , relRange = 1, lims=[1e0,1e3],range_type=&#39;log&#39;,optim_type=&#39;log&#39;,lim_type=&#39;absolute&#39;,display_name=&#39;R$_{sh}$&#39;,unit=&#39;$\Omega$ m$^2$)</span>
<span class="c1"># params.append(Rshunt)</span>

<span class="n">W_R</span> <span class="o">=</span> <span class="n">Fitparam</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;W_R&#39;</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">,</span> <span class="n">relRange</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">lims</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">range_type</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span><span class="n">optim_type</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span><span class="n">lim_type</span><span class="o">=</span><span class="s1">&#39;absolute&#39;</span><span class="p">,</span><span class="n">display_name</span><span class="o">=</span><span class="s1">&#39;W$_R$&#39;</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="s1">&#39;eV&#39;</span><span class="p">)</span>
<span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">W_R</span><span class="p">)</span>

<span class="n">W_L</span> <span class="o">=</span> <span class="n">Fitparam</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;W_L&#39;</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">,</span> <span class="n">relRange</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">lims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">],</span><span class="n">range_type</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span><span class="n">optim_type</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span><span class="n">lim_type</span><span class="o">=</span><span class="s1">&#39;absolute&#39;</span><span class="p">,</span><span class="n">display_name</span><span class="o">=</span><span class="s1">&#39;W$_L$&#39;</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="s1">&#39;eV&#39;</span><span class="p">)</span>
<span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">W_L</span><span class="p">)</span>

<span class="n">CB_LTL</span> <span class="o">=</span> <span class="n">Fitparam</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;CB_LTL&#39;</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">,</span> <span class="n">relRange</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">lims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.4</span><span class="p">],</span><span class="n">range_type</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span><span class="n">optim_type</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span><span class="n">lim_type</span><span class="o">=</span><span class="s1">&#39;absolute&#39;</span><span class="p">,</span><span class="n">display_name</span><span class="o">=</span><span class="s1">&#39;CB$_</span><span class="si">{ETL}</span><span class="s1">$&#39;</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="s1">&#39;eV&#39;</span><span class="p">)</span>
<span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CB_LTL</span><span class="p">)</span>

<span class="n">Gehp</span> <span class="o">=</span> <span class="n">Fitparam</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Gehp&#39;</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="n">Start_values</span><span class="p">[</span><span class="s1">&#39;Gehp&#39;</span><span class="p">]</span> <span class="p">,</span> <span class="n">relRange</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">lims</span><span class="o">=</span><span class="p">[</span><span class="mf">1.1e28</span><span class="p">,</span><span class="mf">2e28</span><span class="p">],</span><span class="n">range_type</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span><span class="n">optim_type</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span><span class="n">axis_type</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span><span class="n">lim_type</span><span class="o">=</span><span class="s1">&#39;absolute&#39;</span><span class="p">,</span><span class="n">display_name</span><span class="o">=</span><span class="s1">&#39;G$_</span><span class="si">{ehp}</span><span class="s1">$&#39;</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="s1">&#39;m$^{-3}$ s$^{-1}$&#39;</span><span class="p">)</span>
<span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Gehp</span><span class="p">)</span>

<span class="n">params_true</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
</section>
</section>
<section id="Start-the-optimization">
<h2>Start the optimization<a class="headerlink" href="#Start-the-optimization" title="Link to this heading"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Here we first perform a fit with the nonideal diode model to extract the series and shunt resistance so that we can use and do not have to fit them again, this is not necessary but will speed up the fit.</span>
<span class="c1"># Get dark JV and fit nonIdeal diode model</span>
<span class="n">use_diode_fit</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">if</span> <span class="n">use_diode_fit</span><span class="p">:</span>
    <span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">weights</span> <span class="o">=</span> <span class="n">get_JV_exp</span><span class="p">([</span><span class="s1">&#39;dark&#39;</span><span class="p">],</span><span class="n">Vlim</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span><span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">path2JV</span> <span class="o">=</span> <span class="n">path2JV</span><span class="p">)</span>
    <span class="n">V</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">J</span> <span class="o">=</span> <span class="n">y</span>
    <span class="c1"># Fit the non ideal diode equation to get the series and shunt resistance</span>
    <span class="n">dio</span> <span class="o">=</span> <span class="n">Non_Ideal_Diode_agent</span><span class="p">()</span> <span class="c1"># initialize the diode agent</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">dio</span><span class="o">.</span><span class="n">FitNonIdealDiode</span><span class="p">(</span><span class="n">V</span><span class="p">,</span><span class="n">J</span><span class="p">,</span><span class="n">T</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span><span class="n">JV_type</span><span class="o">=</span><span class="s1">&#39;dark&#39;</span><span class="p">,</span><span class="n">take_log</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">([</span><span class="mf">1e-20</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">1e-8</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">],</span> <span class="p">[</span><span class="mf">1e-3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">1e2</span><span class="p">,</span> <span class="mf">1e8</span><span class="p">]),</span><span class="n">p_start</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;J0&#39;</span><span class="p">:</span><span class="mf">1e-6</span><span class="p">})</span>
    <span class="n">Rseries</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s1">&#39;Rs&#39;</span><span class="p">]</span>
    <span class="n">Rshunt</span><span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s1">&#39;Rsh&#39;</span><span class="p">]</span>

    <span class="n">fixed_str</span> <span class="o">=</span> <span class="s1">&#39;-Rseries </span><span class="si">{:.5e}</span><span class="s1"> -Rshunt </span><span class="si">{:.5e}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Rseries</span><span class="p">,</span><span class="n">Rshunt</span><span class="p">)</span> <span class="c1"># string to be added to the command line</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">fixed_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<br/></pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Do the fit</span>
<span class="c1"># Get experimental data light JV</span>
<span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">weights</span> <span class="o">=</span> <span class="n">get_JV_exp</span><span class="p">(</span><span class="n">suns</span><span class="p">,</span><span class="n">path2JV</span><span class="o">=</span><span class="n">path2JV</span><span class="p">,</span><span class="n">Vlim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">1.0</span><span class="p">],</span><span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">X_dimensions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Vext&#39;</span><span class="p">,</span><span class="s1">&#39;Gfrac&#39;</span><span class="p">]</span>
<span class="n">fixed_str</span> <span class="o">=</span> <span class="n">fixed_str</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;-Vmin </span><span class="si">{</span><span class="o">-</span><span class="mf">0.25</span><span class="si">}</span><span class="s1"> -Vmax </span><span class="si">{</span><span class="mf">1.25</span><span class="si">}</span><span class="s1"> &#39;</span>
<span class="c1"># Define weighting for the different JV curves</span>
<span class="n">use_weighting</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">if</span> <span class="n">use_weighting</span><span class="p">:</span>
    <span class="n">weight</span> <span class="o">=</span> <span class="n">weights</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">weight</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># initialize the simulation agent</span>
<span class="n">dda</span> <span class="o">=</span> <span class="n">Drift_diffusion_agent</span><span class="p">(</span><span class="n">path2simu</span><span class="o">=</span><span class="n">path2simu</span><span class="p">)</span>

<span class="c1"># Define the target</span>
<span class="n">target</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;model&#39;</span><span class="p">:</span><span class="n">partial</span><span class="p">(</span><span class="n">dda</span><span class="o">.</span><span class="n">DriftDiffusion_relative</span><span class="p">,</span><span class="n">X_dimensions</span><span class="o">=</span><span class="n">X_dimensions</span><span class="p">,</span><span class="n">max_jobs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">fixed_str</span><span class="o">=</span><span class="n">fixed_str</span><span class="p">,</span><span class="n">dev_par_fname</span><span class="o">=</span><span class="n">dev_par_file</span><span class="p">),</span><span class="s1">&#39;target_name&#39;</span><span class="p">:</span><span class="s1">&#39;JV&#39;</span><span class="p">,</span><span class="s1">&#39;data&#39;</span><span class="p">:{</span><span class="s1">&#39;X&#39;</span><span class="p">:</span><span class="n">X</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">:</span><span class="n">y</span><span class="p">,</span>
            <span class="s1">&#39;X_dimensions&#39;</span><span class="p">:[</span><span class="s1">&#39;Vext&#39;</span><span class="p">,</span><span class="s1">&#39;Gfrac&#39;</span><span class="p">],</span><span class="s1">&#39;X_units&#39;</span><span class="p">:[</span><span class="s1">&#39;V&#39;</span><span class="p">,</span><span class="s1">&#39;sun&#39;</span><span class="p">],</span><span class="s1">&#39;y_dimension&#39;</span><span class="p">:</span><span class="s1">&#39;Current density&#39;</span><span class="p">,</span><span class="s1">&#39;y_unit&#39;</span><span class="p">:</span><span class="sa">r</span><span class="s1">&#39;$A m^{-2}$&#39;</span><span class="p">}</span>
            <span class="p">,</span><span class="s1">&#39;params&#39;</span><span class="p">:</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">params</span><span class="p">),</span> <span class="s1">&#39;weight&#39;</span><span class="p">:</span><span class="n">weight</span><span class="p">,</span><span class="s1">&#39;target_weight&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>

<span class="c1"># Define optimizer</span>
<span class="n">mo</span> <span class="o">=</span> <span class="n">MultiObjectiveOptimizer</span><span class="p">(</span><span class="n">res_dir</span><span class="o">=</span><span class="n">res_dir</span><span class="p">,</span><span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span><span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="n">target</span><span class="p">])</span> <span class="c1"># initialize the optimizer</span>
<span class="n">mo</span><span class="o">.</span><span class="n">warmstart</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span> <span class="c1"># &#39;recall&#39; data from Path2OldXY file</span>

<span class="c1"># Define the number of iterations for the optimization</span>
<span class="n">n_jobs</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">n_jobs_init</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">n_yscale</span><span class="o">=</span><span class="mi">20</span>
<span class="n">n_initial_points</span> <span class="o">=</span> <span class="mi">80</span>
<span class="n">n_BO</span> <span class="o">=</span> <span class="mi">80</span>
<span class="n">n_BO_warmstart</span> <span class="o">=</span> <span class="mi">80</span>

<span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;check_improvement&#39;</span><span class="p">:</span><span class="s1">&#39;relax&#39;</span><span class="p">,</span><span class="s1">&#39;max_loop_no_improvement&#39;</span><span class="p">:</span><span class="mi">15</span><span class="p">,</span><span class="s1">&#39;xtol&#39;</span><span class="p">:</span><span class="mf">1e-3</span><span class="p">,</span><span class="s1">&#39;ftol&#39;</span><span class="p">:</span><span class="mf">1e-3</span><span class="p">}</span>
<span class="n">kwargs_posterior</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Nres&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span><span class="s1">&#39;Ninteg&#39;</span><span class="p">:</span><span class="mf">1e5</span><span class="p">,</span><span class="s1">&#39;logscale&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;vmin&#39;</span><span class="p">:</span><span class="mf">1e-100</span><span class="p">,</span><span class="s1">&#39;zoom&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;min_prob&#39;</span><span class="p">:</span><span class="mf">1e-40</span><span class="p">,</span><span class="s1">&#39;clear_axis&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;show_points&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;savefig&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;figname&#39;</span><span class="p">:</span><span class="s1">&#39;param_posterior&#39;</span> <span class="p">,</span><span class="s1">&#39;show_fig&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;figsize&#39;</span><span class="p">:(</span><span class="mi">14</span><span class="p">,</span><span class="mi">14</span><span class="p">)}</span>
<span class="n">kwargs_plot_obj</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;zscale&#39;</span><span class="p">:</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span><span class="s1">&#39;show_fig&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">}</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">mo</span><span class="o">.</span><span class="n">optimize_sko_parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="n">n_jobs</span><span class="p">,</span><span class="n">n_yscale</span><span class="o">=</span><span class="n">n_yscale</span><span class="p">,</span> <span class="n">n_BO</span><span class="o">=</span><span class="n">n_BO</span><span class="p">,</span> <span class="n">n_initial_points</span> <span class="o">=</span> <span class="n">n_initial_points</span><span class="p">,</span><span class="n">n_BO_warmstart</span><span class="o">=</span><span class="n">n_BO_warmstart</span><span class="p">,</span><span class="n">n_jobs_init</span><span class="o">=</span><span class="n">n_jobs_init</span><span class="p">,</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;soft_l1&#39;</span><span class="p">,</span><span class="n">threshold</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">base_estimator</span> <span class="o">=</span> <span class="s1">&#39;GP&#39;</span><span class="p">,</span><span class="n">show_objective_func</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">show_posterior</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">kwargs_posterior</span> <span class="o">=</span> <span class="n">kwargs_posterior</span><span class="p">,</span><span class="n">kwargs_plot_obj</span><span class="o">=</span><span class="n">kwargs_plot_obj</span><span class="p">)</span>
<span class="c1"># pf.append(deepcopy(target[&#39;params&#39;])) # collects optimized fitparameters</span>
<span class="n">rrr</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span> <span class="c1"># the results dict of the last optimizer.tell()</span>

<span class="n">best_params</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">mo</span><span class="o">.</span><span class="n">params</span><span class="p">)</span> <span class="c1"># get the best parameters</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "add42ce4a2a140149a9f8353b4956e0b", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Starting with initial points
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "7d58f856697240a19f4a637bb028fa74", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Initial points done in 50.03 s
Starting with BO
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "02e08cfbcf274f42b14bce02e02e969a", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
BO done in 230.43 s
Ground truth minimum at: [17.05740378811364, -19.0, -6.0, -7.198760680572275, -2.208575728933771, 1.6553486570971978, 2.0] with function value: 2.034499084176799
Minimum of surrogate function: [17.000000000442114, -19.0, -6.0, -6.995893187076919, -2.215869798310859, 1.5995416534664864, 2.0] with function value 2.05771796177784
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_DD_Fit_real_OPV_13_6.png" src="../_images/examples_DD_Fit_real_OPV_13_6.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot the 2D posterior</span>
<span class="n">mo</span><span class="o">.</span><span class="n">marginal_posterior_2D</span><span class="p">(</span><span class="s1">&#39;mun_0&#39;</span><span class="p">,</span><span class="s1">&#39;mup_0&#39;</span><span class="p">,</span><span class="n">points</span><span class="o">=</span><span class="n">mo</span><span class="o">.</span><span class="n">points</span><span class="p">,</span><span class="n">logscale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">Nres</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">Ninteg</span><span class="o">=</span><span class="mf">1e5</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="mf">1e-40</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_DD_Fit_real_OPV_14_0.png" src="../_images/examples_DD_Fit_real_OPV_14_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot the fit results</span>
<span class="n">fit_results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">kwargs_plot_res</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x_scaling&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;xaxis_label&#39;</span><span class="p">:</span><span class="s1">&#39;Voltage [V]&#39;</span><span class="p">,</span><span class="s1">&#39;xscale_type&#39;</span><span class="p">:</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span><span class="s1">&#39;y_scaling&#39;</span><span class="p">:</span><span class="mi">1</span><span class="o">/</span><span class="mi">10</span><span class="p">,</span><span class="s1">&#39;yaxis_label&#39;</span><span class="p">:</span><span class="s1">&#39;Current density [mA cm$^2$]&#39;</span><span class="p">,</span><span class="s1">&#39;yscale_type&#39;</span><span class="p">:</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span><span class="s1">&#39;norm_data&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span><span class="s1">&#39;delog&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span><span class="s1">&#39;figsize&#39;</span><span class="p">:(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span><span class="s1">&#39;savefig&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span><span class="s1">&#39;figname&#39;</span><span class="p">:</span><span class="s1">&#39;JV_fits&#39;</span><span class="p">,</span><span class="s1">&#39;figdir&#39;</span><span class="p">:</span><span class="s1">&#39;temp&#39;</span><span class="p">}</span>

<span class="k">for</span> <span class="n">num</span><span class="p">,</span><span class="n">t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mo</span><span class="o">.</span><span class="n">targets</span><span class="p">):</span>
    <span class="n">kwargs_plot_res</span><span class="p">[</span><span class="s1">&#39;figname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">res_dir</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;target_name&#39;</span><span class="p">]</span><span class="o">+</span><span class="sa">f</span><span class="s1">&#39;_fit_</span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">dda</span><span class="o">.</span><span class="n">plot_fit_res</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">mo</span><span class="o">.</span><span class="n">params</span><span class="p">,</span><span class="s1">&#39;Vext&#39;</span><span class="p">,</span><span class="n">xlim</span><span class="o">=</span><span class="p">[],</span><span class="n">ylim</span><span class="o">=</span><span class="p">[],</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs_plot_res</span><span class="p">)</span>

    <span class="n">X</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;X&#39;</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>
    <span class="n">X_dimensions</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;X_dimensions&#39;</span><span class="p">]</span>
    <span class="n">yfit</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">](</span><span class="n">X</span><span class="p">,</span><span class="n">mo</span><span class="o">.</span><span class="n">params</span><span class="p">,</span><span class="n">X_dimensions</span><span class="o">=</span><span class="n">X_dimensions</span><span class="p">)</span> <span class="c1"># get the best fits</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">),</span><span class="mi">1</span><span class="p">),</span> <span class="n">yfit</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">yfit</span><span class="p">),</span><span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">fit_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c1"># prepare the data for saving</span>
<span class="n">param_dict</span> <span class="o">=</span> <span class="n">dda</span><span class="o">.</span><span class="n">get_param_dict</span><span class="p">(</span><span class="n">mo</span><span class="o">.</span><span class="n">params</span><span class="p">)</span> <span class="c1"># get fitparameters (and fixed ones) as dict</span>
<span class="n">pout</span> <span class="o">=</span> <span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">v</span><span class="si">:</span><span class="s1">.3E</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="nb">float</span><span class="p">)</span> <span class="k">else</span> <span class="n">v</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">pp</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span> <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">param_dict</span><span class="p">]</span> <span class="c1"># convert to list of lists</span>


<span class="c1"># produce output excel file with data, fitparameters and FOMs</span>
<span class="n">fn_xlsx</span> <span class="o">=</span> <span class="s1">&#39;fits_results.xlsx&#39;</span>
<span class="n">namecols</span> <span class="o">=</span> <span class="n">X_dimensions</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;Jexp&#39;</span><span class="p">,</span><span class="s1">&#39;Jfit&#39;</span><span class="p">]</span>
<span class="c1"># delete old file if it exists</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">res_dir</span><span class="p">,</span><span class="n">fn_xlsx</span><span class="p">)):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">res_dir</span><span class="p">,</span><span class="n">fn_xlsx</span><span class="p">))</span>

<span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">res_dir</span><span class="p">,</span><span class="n">fn_xlsx</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">writer</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mo</span><span class="o">.</span><span class="n">targets</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;target_name&#39;</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">tname</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;target_name&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tname</span> <span class="o">=</span> <span class="s1">&#39;data&#39;</span>
        <span class="n">namecols</span> <span class="o">=</span> <span class="n">X_dimensions</span> <span class="o">+</span> <span class="p">[</span><span class="n">tname</span><span class="o">+</span><span class="s1">&#39;_exp&#39;</span><span class="p">,</span><span class="n">tname</span><span class="o">+</span><span class="s1">&#39;_fit&#39;</span><span class="p">]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">fit_results</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">columns</span><span class="o">=</span><span class="n">namecols</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span> <span class="o">=</span> <span class="n">tname</span><span class="o">+</span><span class="sa">f</span><span class="s1">&#39;_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pout</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">param_dict</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
    <span class="n">df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;params&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_DD_Fit_real_OPV_15_0.png" src="../_images/examples_DD_Fit_real_OPV_15_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Clean output files from simulation folders</span>
<span class="kn">from</span> <span class="nn">boar.SIMsalabim_utils.CleanFolder</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">Do_Cleaning</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># Careful, this will delete all files in the folder</span>
<span class="k">if</span> <span class="n">Do_Cleaning</span><span class="p">:</span>
    <span class="n">clean_up_output</span><span class="p">(</span><span class="s1">&#39;tj&#39;</span><span class="p">,</span><span class="n">path2simu</span><span class="p">)</span>
    <span class="n">clean_up_output</span><span class="p">(</span><span class="s1">&#39;tVG&#39;</span><span class="p">,</span><span class="n">path2simu</span><span class="p">)</span>
    <span class="n">clean_up_output</span><span class="p">(</span><span class="s1">&#39;JV&#39;</span><span class="p">,</span><span class="n">path2simu</span><span class="p">)</span>
    <span class="n">clean_up_output</span><span class="p">(</span><span class="s1">&#39;Var&#39;</span><span class="p">,</span><span class="n">path2simu</span><span class="p">)</span>
    <span class="n">clean_up_output</span><span class="p">(</span><span class="s1">&#39;scPars&#39;</span><span class="p">,</span><span class="n">path2simu</span><span class="p">)</span>
    <span class="n">clean_up_output</span><span class="p">(</span><span class="s1">&#39;Str4Parallel&#39;</span><span class="p">,</span><span class="n">path2simu</span><span class="p">)</span>
    <span class="n">clean_up_output</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">,</span><span class="n">path2simu</span><span class="p">)</span>
    <span class="c1"># os.remove(mo.path2oldxy) # remove the old_xy.json file if it exists</span>
    <span class="c1"># delete warmstart folder if it exists</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span><span class="s1">&#39;warmstart/&#39;</span><span class="p">)):</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span><span class="s1">&#39;warmstart/&#39;</span><span class="p">))</span>
    <span class="c1"># delete temp folder if it exists</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">res_dir</span><span class="p">):</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">res_dir</span><span class="p">)</span>
<br/><br/></pre></div>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="DD_Fit_fake_OPV.html" class="btn btn-neutral float-left" title="BOAR with SIMsalabim" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="TAS_fit_BT_model_fake.html" class="btn btn-neutral float-right" title="BOAR for TAS fitting" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Vincent M. Le Corre, Larry Lüer.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>